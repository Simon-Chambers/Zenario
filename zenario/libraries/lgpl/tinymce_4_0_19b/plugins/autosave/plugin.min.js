tinymce.PluginManager.add("autosave",function(a){function l(b,a){var c={s:1E3,m:6E4};b=/^(\d+)([ms]?)$/.exec(""+(b||a));return(b[2]?c[b[2]]:1)*parseInt(b,10)}function f(){var b=parseInt(e.getItem(c+"time"),10)||0;return(new Date).getTime()-b>d.autosave_retention?(g(!1),!1):!0}function g(b){e.removeItem(c+"draft");e.removeItem(c+"time");!1!==b&&a.fire("RemoveDraft")}function m(){!h()&&a.isDirty()&&(e.setItem(c+"draft",a.getContent({format:"raw",no_events:!0})),e.setItem(c+"time",(new Date).getTime()),
a.fire("StoreDraft"))}function k(){f()&&(a.setContent(e.getItem(c+"draft"),{format:"raw"}),a.fire("RestoreDraft"))}function r(){n||(setInterval(function(){a.removed||m()},d.autosave_interval),n=!0)}function p(){var b=this;b.disabled(!f());a.on("StoreDraft RestoreDraft RemoveDraft",function(){b.disabled(!f())});r()}function q(){a.undoManager.beforeChange();k();g();a.undoManager.add()}function h(b){var c=a.settings.forced_root_block;b=tinymce.trim("undefined"==typeof b?a.getBody().innerHTML:b);return""===
b||RegExp("^<"+c+"[^>]*>((\u00a0|&nbsp;|[ \t]|<br[^>]*>)+?|)</"+c+">|<br>$","i").test(b)}var d=a.settings,e=tinymce.util.LocalStorage,c,n;c=d.autosave_prefix||"tinymce-autosave-{path}{query}-{id}-";c=c.replace(/\{path\}/g,document.location.pathname);c=c.replace(/\{query\}/g,document.location.search);c=c.replace(/\{id\}/g,a.id);d.autosave_interval=l(d.autosave_interval,"30s");d.autosave_retention=l(d.autosave_retention,"20m");a.addButton("restoredraft",{title:"Restore last draft",onclick:q,onPostRender:p});
a.addMenuItem("restoredraft",{text:"Restore last draft",onclick:q,onPostRender:p,context:"file"});!1!==a.settings.autosave_restore_when_empty&&(a.on("init",function(){f()&&h()&&k()}),a.on("saveContent",function(){g()}));window.onbeforeunload=function(){var b;tinymce.each(tinymce.editors,function(a){a.plugins.autosave&&a.plugins.autosave.storeDraft();!b&&a.isDirty()&&a.getParam("autosave_ask_before_unload",!0)&&(b=a.translate("You have unsaved changes are you sure you want to navigate away?"))});return b};
this.hasDraft=f;this.storeDraft=m;this.restoreDraft=k;this.removeDraft=g;this.isEmpty=h});
