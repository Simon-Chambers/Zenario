tinymce.PluginManager.add("autolink",function(d){function g(e,d,f){var a,c,b;a=e.selection.getRng(!0).cloneRange();if(5>a.startOffset){b=a.endContainer.previousSibling;if(!b){if(!a.endContainer.firstChild||!a.endContainer.firstChild.nextSibling)return;b=a.endContainer.firstChild.nextSibling}d=b.length;a.setStart(b,d);a.setEnd(b,d);if(5>a.endOffset)return;c=a.endOffset}else{b=a.endContainer;if(3!=b.nodeType&&b.firstChild){for(;3!=b.nodeType&&b.firstChild;)b=b.firstChild;3==b.nodeType&&(a.setStart(b,
0),a.setEnd(b,b.nodeValue.length))}c=1==a.endOffset?2:a.endOffset-1-d}d=c;do a.setStart(b,2<=c?c-2:0),a.setEnd(b,1<=c?c-1:0),c-=1;while(" "!=a.toString()&&""!==a.toString()&&160!=a.toString().charCodeAt(0)&&0<=c-2&&a.toString()!=f);a.toString()==f||160==a.toString().charCodeAt(0)?a.setStart(b,c):0===a.startOffset?a.setStart(b,0):a.setStart(b,c);a.setEnd(b,d);f=a.toString();"."==f.charAt(f.length-1)&&a.setEnd(b,d-1);f=a.toString();if(c=f.match(/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i))"www."==
c[1]?c[1]="http://www.":/@$/.test(c[1])&&!/^mailto:/.test(c[1])&&(c[1]="mailto:"+c[1]),f=e.selection.getBookmark(),e.selection.setRng(a),e.execCommand("createlink",!1,c[1]+c[2]),e.selection.moveToBookmark(f),e.nodeChanged(),tinymce.Env.webkit&&(e.selection.collapse(!1),f=Math.min(b.length,d+1),a.setStart(b,f),a.setEnd(b,f),e.selection.setRng(a))}var h;d.on("keydown",function(e){13==e.keyCode&&g(d,-1,"",!1)});if(tinymce.Env.ie)d.on("focus",function(){if(!h){h=!0;try{d.execCommand("AutoUrlDetect",!1,
!0)}catch(e){}}});else d.on("keypress",function(e){41==e.which&&g(d,-1,"(",!0)}),d.on("keyup",function(e){32==e.keyCode&&g(d,0,"",!0)})});
