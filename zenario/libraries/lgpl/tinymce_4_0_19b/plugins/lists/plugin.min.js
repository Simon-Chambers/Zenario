tinymce.PluginManager.add("lists",function(f){function h(f){return f&&/^(OL|UL)$/.test(f.nodeName)}function u(l){return l&&!!f.schema.getTextBlockElements()[l.nodeName]}var v=this;f.on("init",function(){function l(b){function c(c){var k,g,m;g=b[c?"startContainer":"endContainer"];m=b[c?"startOffset":"endOffset"];1==g.nodeType&&(k=d.create("span",{"data-mce-type":"bookmark"}),g.hasChildNodes()?(m=Math.min(m,g.childNodes.length-1),c?g.insertBefore(k,g.childNodes[m]):d.insertAfter(k,g.childNodes[m])):
g.appendChild(k),g=k,m=0);a[c?"startContainer":"endContainer"]=g;a[c?"startOffset":"endOffset"]=m}var a={};c(!0);b.collapsed||c();return a}function s(b){function c(a){var c,g,m;c=m=b[a?"startContainer":"endContainer"];g=b[a?"startOffset":"endOffset"];if(c){if(1==c.nodeType){a:{g=c;for(var f=g.parentNode.firstChild,t=0;f;){if(f==g){g=t;break a}1==f.nodeType&&"bookmark"==f.getAttribute("data-mce-type")||t++;f=f.nextSibling}g=-1}c=c.parentNode;d.remove(m)}b[a?"startContainer":"endContainer"]=c;b[a?"startOffset":
"endOffset"]=g}}c(!0);c();var a=d.createRng();a.setStart(b.startContainer,b.startOffset);b.endContainer&&a.setEnd(b.endContainer,b.endOffset);n.setRng(a)}function r(b,c){var a,e,k=d.createFragment(),g,m=f.schema.getBlockElements();f.settings.forced_root_block&&(c=c||f.settings.forced_root_block);c&&(e=d.create(c),e.tagName===f.settings.forced_root_block&&d.setAttribs(e,f.settings.forced_root_block_attrs),k.appendChild(e));if(b)for(;a=b.firstChild;){var p=a.nodeName;g||"SPAN"==p&&"bookmark"==a.getAttribute("data-mce-type")||
(g=!0);m[p]?(k.appendChild(a),e=null):c?(e||(e=d.create(c),k.appendChild(e)),e.appendChild(a)):k.appendChild(a)}f.settings.forced_root_block?g||tinymce.Env.ie&&!(10<tinymce.Env.ie)||e.appendChild(d.create("br",{"data-mce-bogus":"1"})):k.appendChild(d.create("br"));return k}function w(){return tinymce.grep(n.getSelectedBlocks(),function(b){return"LI"==b.nodeName})}function x(b,c,a){var e,k=d.select('span[data-mce-type="bookmark"]',b);a=a||r(c);e=d.createRng();e.setStartAfter(c);e.setEndAfter(b);e=
e.extractContents();d.isEmpty(e)||d.insertAfter(e,b);d.insertAfter(a,b);d.isEmpty(c.parentNode)&&(tinymce.each(k,function(a){c.parentNode.parentNode.insertBefore(a,c.parentNode)}),d.remove(c.parentNode));d.remove(c)}function y(b){var c,a;if((c=b.nextSibling)&&h(c)&&c.nodeName==b.nodeName){for(;a=c.firstChild;)b.appendChild(a);d.remove(c)}if((c=b.previousSibling)&&h(c)&&c.nodeName==b.nodeName){for(;a=c.firstChild;)b.insertBefore(a,b.firstChild);d.remove(c)}}function E(b){tinymce.each(tinymce.grep(d.select("ol,ul",
b)),function(b){var a,e=b.parentNode;"LI"==e.nodeName&&e.firstChild==b&&(a=e.previousSibling)&&"LI"==a.nodeName&&(a.appendChild(b),d.isEmpty(e)&&d.remove(e));h(e)&&(a=e.previousSibling)&&"LI"==a.nodeName&&a.appendChild(b)})}function z(b){var c=b.parentNode,a=c.parentNode;b.parentNode.firstChild==b&&b.parentNode.lastChild==b?"LI"==a.nodeName?(d.insertAfter(b,a),d.isEmpty(a)&&d.remove(a),d.remove(c)):h(a)?d.remove(c,!0):(a.insertBefore(r(b),c),d.remove(c)):b.parentNode.firstChild==b?"LI"==a.nodeName?
(d.insertAfter(b,a),b.appendChild(c),d.isEmpty(a)&&d.remove(a)):h(a)?a.insertBefore(b,c):(a.insertBefore(r(b),c),d.remove(b)):b.parentNode.lastChild==b?"LI"==a.nodeName?d.insertAfter(b,a):h(a)?d.insertAfter(b,c):(d.insertAfter(r(b),c),d.remove(b)):("LI"==a.nodeName?(c=a,a=r(b,"LI")):a=h(a)?r(b,"LI"):r(b),x(c,b,a),E(c.parentNode));return!0}function F(b){function c(a,c){var e;if(h(a)){for(;e=b.lastChild.firstChild;)c.appendChild(e);d.remove(a)}}var a,e;return(a=b.previousSibling)&&h(a)?(a.appendChild(b),
!0):a&&"LI"==a.nodeName&&h(a.lastChild)?(a.lastChild.appendChild(b),c(b.lastChild,a.lastChild),!0):(a=b.nextSibling)&&h(a)?(a.insertBefore(b,a.firstChild),!0):a&&"LI"==a.nodeName&&h(b.lastChild)?!1:(a=b.previousSibling)&&"LI"==a.nodeName?(e=d.create(b.parentNode.nodeName),a.appendChild(e),e.appendChild(b),c(b.lastChild,e),!0):!1}function A(){var b=w();if(b.length){for(var c=l(n.getRng(!0)),a=0;a<b.length&&(F(b[a])||0!==a);a++);s(c);f.nodeChanged();return!0}}function B(){var b=w();if(b.length){var c=
l(n.getRng(!0)),a,d,k=f.getBody();for(a=b.length;a--;)for(var g=b[a].parentNode;g&&g!=k;){for(d=b.length;d--;)if(b[d]===g){b.splice(a,1);break}g=g.parentNode}for(a=0;a<b.length&&(z(b[a])||0!==a);a++);s(c);f.nodeChanged();return!0}}function G(b){var c=n.getRng(!0),a=l(c),e=function(){function a(b){var d;d=c[b?"startContainer":"endContainer"];b=c[b?"startOffset":"endOffset"];for(1==d.nodeType&&(d=d.childNodes[Math.min(b,d.childNodes.length-1)]||d);d.parentNode!=e&&!u(d)&&!/^(TD|TH)$/.test(d.parentNode.nodeName);)d=
d.parentNode;return d}for(var b=[],e=f.getBody(),p=a(!0),t=a(),q,l=[];p&&(l.push(p),p!=t);p=p.nextSibling);tinymce.each(l,function(a){if(u(a))b.push(a),q=null;else if(d.isBlock(a)||"BR"==a.nodeName)"BR"==a.nodeName&&d.remove(a),q=null;else{var c=a.nextSibling;a&&"SPAN"===a.nodeName&&"bookmark"===a.getAttribute("data-mce-type")&&(u(c)||!c&&a.parentNode==e)?q=null:(q||(q=d.create("p"),a.parentNode.insertBefore(q,a),b.push(q)),q.appendChild(a))}});return b}();tinymce.each(e,function(a){var c,e;(e=a.previousSibling)&&
h(e)&&e.nodeName==b?(c=e,a=d.rename(a,"LI"),e.appendChild(a)):(c=d.create(b),a.parentNode.insertBefore(c,a),c.appendChild(a),d.rename(a,"LI"));y(c)});s(a)}function C(){var b=l(n.getRng(!0)),c=f.getBody();tinymce.each(w(),function(a){var b,f;if(d.isEmpty(a))z(a);else{for(b=a;b&&b!=c;b=b.parentNode)h(b)&&(f=b);x(f,a)}});s(b)}function D(b){var c=d.getParent(n.getStart(),"OL,UL");if(c)if(c.nodeName==b)C(b);else{var a=l(n.getRng(!0));y(d.rename(c,b));s(a)}else G(b)}var d=f.dom,n=f.selection;v.backspaceDelete=
function(b){function c(a,b){var c=a.startContainer,d=a.startOffset;if(3==c.nodeType&&(b?d<c.data.length:0<d))return c;for(d=new tinymce.dom.TreeWalker(a.startContainer);c=d[b?"next":"prev"]();)if(3==c.nodeType&&0<c.data.length)return c}function a(a,b){var c,e,f=a.parentNode;h(b.lastChild)&&(e=b.lastChild);for((c=b.lastChild)&&"BR"==c.nodeName&&a.hasChildNodes()&&d.remove(c);c=a.firstChild;)b.appendChild(c);e&&b.appendChild(e);d.remove(a);d.isEmpty(f)&&d.remove(f)}if(n.isCollapsed()){var e=d.getParent(n.getStart(),
"LI");if(e){var f=n.getRng(!0),g=d.getParent(c(f,b),"LI");if(g&&g!=e)return f=l(f),b?a(g,e):a(e,g),s(f),!0;if(!g&&!b&&C(e.parentNode.nodeName))return!0}}};f.addCommand("Indent",function(){if(!A())return!0});f.addCommand("Outdent",function(){if(!B())return!0});f.addCommand("InsertUnorderedList",function(){D("UL")});f.addCommand("InsertOrderedList",function(){D("OL")});f.on("keydown",function(b){9==b.keyCode&&f.dom.getParent(f.selection.getStart(),"LI")&&(b.preventDefault(),b.shiftKey?B():A())})});
f.addButton("indent",{icon:"indent",title:"Increase indent",cmd:"Indent",onPostRender:function(){var l=this;f.on("nodechange",function(){var h=f.dom.getParent(f.selection.getNode(),"LI,UL,OL");l.disabled(h&&("LI"!=h.nodeName||h.parentNode.firstChild==h))})}});f.on("keydown",function(f){f.keyCode==tinymce.util.VK.BACKSPACE?v.backspaceDelete()&&f.preventDefault():f.keyCode==tinymce.util.VK.DELETE&&v.backspaceDelete(!0)&&f.preventDefault()})});
