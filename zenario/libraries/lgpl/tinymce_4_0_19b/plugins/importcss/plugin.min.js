tinymce.PluginManager.add("importcss",function(e){function m(c){return"string"==typeof c?function(b){return-1!==b.indexOf(c)}:c instanceof RegExp?function(b){return c.test(b)}:c}function q(c,b){function f(a,c){var d=a.href,e;if(c||k[d])if(!b||b(d)){g(a.imports,function(a){f(a,!0)});try{e=a.cssRules||a.rules}catch(l){}g(e,function(a){a.styleSheet?f(a.styleSheet,!0):a.selectorText&&g(a.selectorText.split(","),function(a){h.push(tinymce.trim(a))})})}}var h=[],k={};g(e.contentCSS,function(a){k[a]=!0});
try{g(c.styleSheets,function(a){f(a)})}catch(d){}return h}function n(c){var b,f=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(c);if(f){var h=f[1],k=f[2].substr(1).split(".").join(" "),d=tinymce.makeMap("a,img");f[1]?(b={title:c},e.schema.getTextBlockElements()[h]?b.block=h:e.schema.getBlockElements()[h]||d[h.toLowerCase()]?b.selector=h:b.inline=h):f[2]&&(b={inline:"span",title:c.substr(1),classes:k});!1!==e.settings.importcss_merge_classes?b.classes=k:b.attributes={"class":k};return b}}var p=this,
g=tinymce.each;e.on("renderFormatsMenu",function(c){var b=e.settings,f={},h=b.importcss_selector_converter||n,k=m(b.importcss_selector_filter);e.settings.importcss_append||c.control.items().remove();var d=[];tinymce.each(b.importcss_groups,function(a){a=tinymce.extend({},a);a.filter=m(a.filter);d.push(a)});g(q(e.getDoc(),m(b.importcss_file_filter)),function(a){if(-1===a.indexOf(".mce-")&&!f[a]&&(!k||k(a))){var b=h.call(p,a),g;if(b){var m=b.name||tinymce.DOM.uniqueId();if(d)for(var l=0;l<d.length;l++)if(!d[l].filter||
d[l].filter(a)){d[l].item||(d[l].item={text:d[l].title,menu:[]});g=d[l].item.menu;break}e.formatter.register(m,b);b=tinymce.extend({},c.control.settings.itemDefaults,{text:b.title,format:m});g?g.push(b):c.control.add(b)}f[a]=!0}});g(d,function(a){c.control.add(a.item)});c.control.renderNew()});p.convertSelectorToFormat=n});
